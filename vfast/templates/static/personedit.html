<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
     {% include "head.html" %}
    <script src="/static/js/image_compress.js"></script>
    <link rel="stylesheet" href="/static/css/drop-down.css" />
    <script src="/static/js/jquery-ui.min.js"></script>
    <script src="/static/js/select-widget-min.js"></script>
    <style>
        #head_cont{
            box-shadow: none;
        }
        .my-persona{width: 1200px;
        margin: 0 auto}
        .persona-left{
            width: 65%;
            background-color: #ffffff;
            float: left;
        }
        .persona-right{
            width: 25%;;
            float: right;
            background-color: #F0F2F4;
        }
        .persona-img{width: 160px;
        height: 160px;
        background-color: red;
        border-radius: 80px;
        float: left}
        #persona-left ul{display: none}
        #persona-left ul.fdiv{display: block}
        .info_1_head{
            margin-top: 50px;
            height: 100px;
            line-height: 100px;
        }
       .info_1_head>p{
           float: left;
           height: 100px;
           line-height: 100px;
           margin: 0px !important;
           width: 100px;
           text-align: center;
       }
       .info_1_head_1{
           float: left;
           height: 100px;
           position:relative;
       }
       .info_1_head>.info_1_head_1>img{
            position:absolute;
        }
        .info_1_head>.info_1_head_1>img:first-child{
            left: 1px;
            width: 100px;
            height:100px;
            border-radius: 100px;
        }
        .info_1_head>.info_1_head_1>img:last-child{
            top:5px;
            left: 70px;
        }
        .info_1_head>.info_1_head_2{
            float: right;
            width:50%;
            position:relative;
            padding: 8px 0px 0px 20px;
        }
        .info_1_head_2>div{
            width:96px;
            height:38px;
        }
        .info_1_head_2>div:hover{
            cursor: pointer;
            opacity:0.8;
        }
        .info_1_head_2>div>div:first-child{
            width:96px;
            height:38px;
            line-height: 38px;
            border:2px solid #ECEFF1;
            position: absolute;
            background: #ECEFF1;
            border-radius: 4px;
            text-align: center;
            font-size: 16px;
            color: #8C96A5;
        }
        .info_1_head_2>div>input{
            width:96px;
            height:40px;
            position: relative;
            border: none;
            margin: 0;
            opacity: 0;
            display: none;
        }
        .info_1_head_2>input:hover{
            cursor:pointer;
        }
        .info_1_head_2>div:last-child{
            width:96px;
            height:38px;
            line-height: 38px;
            border:2px solid #ECEFF1;
            background: #ECEFF1;
            border-radius: 4px;
            text-align: center;
            font-size: 16px;
            color: #8C96A5;
            margin-top: 16px;
            user-select: none;
        }
        .info_1_head_2>div:last-child:hover{
            cursor: pointer;
            opacity: 0.8;
        }
        .info_1_head_2>div:last-child:active{
            background: #FFFFFF;
        }
        .conmmcpone>p{
           text-align:center;
            float: left;
            width: 100px;
            margin: 0px !important;
        }
        .conmmcpone>input{
            line-height: initial!important;
            width: 300px;
            height: 35px;
        }
        .conmmcpone>div>input{
            line-height: initial!important;
            width: 300px;
            height: 35px;
        }
        .conmmcpone{
            height: 100px;
            line-height: 100px;
        }
        .conmmcptwo{
            height: 100px;
            line-height: 100px;
        }
        .conmmcptwo>p{
            text-align: center;
            float: left;
            width: 100px;
            margin: 0px !important;
        }
        .conmmcptwo>input{
            width: 300px;
        }
        .conmm_1{
            height: 50px;
            line-height: 50px;
        }
        .conmm_1>div{
            margin-right: 10%;
            margin-left: 20%;
            float: left;
            height: 45px;
            margin-top: 5px;
        }
        .conmm_1>p{
            margin: 0px !important;
        }
        .fli{ background-color:  #B7C0C7}
         .promptDIV{
            width:100%;
            height:73px;
            box-shadow: 0 2px 1px 0 rgba(0,0,0,0.25);
            background: #5ACD91;
            color: #FFFFFF;
            text-align: center;
            line-height: 70px;
            font-size: 20px;
            position: fixed;
            top: -75px;
            z-index: 2001;
            transition: all 0.35s ease-out;
        }
    </style>
</head>
<body>
<main class="main-wrap">
    <header id="navbar1" class="navbar1">{% include "navbar.html" %}</header>
     <section class="promptDIV" id="promptDIV"></section>
    <div style="height: 50px"></div>
     <div class="my-persona">
         <section class="container">
          <div class="persona-left" id="persona-left">
              <ul class="fdiv">
                  <li>
                  <div class="info_1_head">
                <p>头像</p>
                <div class="info_1_head_1">
                    <img id="uheadimg_this" src="{{ user.headimg }}" alt=""/>
                    <img src="/static/head/OvalBIG.svg" alt=""/>
                    <img src="/static/head/online.svg" alt=""/>
                </div>
                    <div class="info_1_head_2">
                        <div>
                           <div onclick="$('#headimg').click()">更换图片</div>
                           <input name="headimg" id="headimg" type="file">
                            <div onclick="resetHP()">恢复预设</div>
                        </div>
                     </div>
                   </div>
                  </li>
                  <li>
                      <div class="conmmcpone">
                         <p>称呼</p>
                          <div>
                           <input value="{{ user.nickname }}" type="text" onblur="submitINFO_name(this)" placeholder="昵称">
                           <span></span>
                          </div>
                       </div>
                  </li>
                  <li>
                      <div class="conmmcpone">
                          <p>邮箱</p>
                           <input value="{% if user.email != None %}{{ user.email }}{% endif %}" onblur="submitINFO('邮箱')" name="email" form="fileForm" type="text" placeholder="邮箱">
                      </div>
                  </li>
                  <li>
                      <div class="conmmcptwo">
                      <p>自我描述</p>
                      <div class="info_3">
                      <textarea placeholder="自我介绍" form="fileForm" name="intro" id="" cols="35" rows="1" onblur="submitINFO('自我介绍')">{{ user.intro }}</textarea>
                       </div>
                      </div>
                  </li>
                  <li>
                      <div class="conmmcpone">
                       <p>当前位置</p>
                       <input value="{{ user.city }}" onblur="submitINFO('居住城市')" name="city" form="fileForm" type="text" placeholder="居住城市">
                      </div>
                  </li>
                  <li>
                     <div class="conmmcpone">
                         <p>生日</p>
                         <input value="{{ user.birthday }}" onblur="submitINFO('生日')" name="birthday" form="fileForm" type="text" placeholder="yyyy-mm-dd">
                     </div>
                  </li>
              </ul>
              <ul>
                 <li>
                     <p>新手机号</p><input value="{{ user.phone }}" onblur="submitINFO_phone(this)" type="text" id="phone" placeholder="手机号码"><span></span>
                 </li>
                  <li>
                       <button onclick="getVCode()" id="phone_button" class="phone_button">发送验证码</button>
                  </li>
              </ul>
              <ul>
                  <li>
                      <p>新密码</p><input>
                  </li>
                  <li>
                      <p>再次确认</p><input>
                  </li>
              </ul>
           <div style="clear: none"></div>
          </div>
          <div class="persona-right" id="persona-right">
              <ul id="right_ul">
                  <li class="fli">
                      <div class="conmm_1">
                          <div>
                              <svg t="1504939670936" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3280" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20">
                              <defs><style type="text/css"></style></defs>
                              <path d="M500 128.8c-95.2 5.6-173.6 83.2-180 178.4-7.2 112 80.8 205.6 191.2 205.6 106.4 0 192-86.4 192-192 0.8-110.4-92-198.4-203.2-192zM512 575.2c-128 0-383.2 64-383.2 192v96c0 17.6 14.4 32 32 32h702.4c17.6 0 32-14.4 32-32V766.4c0-127.2-255.2-191.2-383.2-191.2z" p-id="3281"></path></svg>
                          </div>
                          <p>个人设置</p>
                      </div >
                      </li>
                  <li>
                      <div class="conmm_1">
                          <div>
                              <svg t="1504939491386" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3544" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20">
                              <defs><style type="text/css"></style></defs>
                              <path d="M800 448H704V320c0-106.4-85.6-192-192-192S320 213.6 320 320v128H224c-17.6 0-32 14.4-32 32v384c0 17.6 14.4 32 32 32h576c17.6 0 32-14.4 32-32V480c0-17.6-14.4-32-32-32zM512 736c-35.2 0-64-28.8-64-64s28.8-64 64-64 64 28.8 64 64-28.8 64-64 64z m128-288H384V320c0-70.4 57.6-128 128-128s128 57.6 128 128v128z" p-id="3545"></path></svg>
                          </div>
                          <p>修改密码</p>
                      </div>
                  </li>
                  <li>
                      <div class="conmm_1">
                          <div>
                              <svg t="1504939629255" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2120" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20">
                              <defs><style type="text/css"></style></defs><path d="M798.723234 174.782745c0-60.576657-49.106418-109.683075-109.683075-109.683075l-354.708628 0c-60.576657 0-109.683075 49.106418-109.683075 109.683075l0 673.980161c0 60.576657 49.106418 109.683075 109.683075 109.683075l354.708628 0c60.576657 0 109.683075-49.106418 109.683075-109.683075L798.723234 174.782745zM264.557398 237.015112l494.256894 0 0 529.049305-494.256894 0L264.557398 237.015112zM334.356091 105.008612 689.016623 105.008612c38.548968 0 69.798692 31.249725 69.798692 69.798692l0 22.298865-494.256894 0 0-22.298865C264.557398 136.25936 295.807123 105.008612 334.356091 105.008612zM689.016623 918.53704 334.356091 918.53704c-38.548968 0-69.798692-31.249725-69.798692-69.798692l0-43.788296 494.256894 0 0 43.788296C758.814292 887.287315 727.564567 918.53704 689.016623 918.53704z" p-id="2121"></path><path d="M513.173732 829.943282c-16.70752 0-30.30112 13.5936-30.30112 30.30112 0 16.70752 13.5936 30.30112 30.30112 30.30112s30.299073-13.5936 30.299073-30.30112C543.472805 843.536882 529.881253 829.943282 513.173732 829.943282z" p-id="2122"></path></svg>
                          </div>
                          <p>手机号变更</p>
                      </div>
                  </li>
              </ul>
          </div>
         </section>
    <div class="slideDIV" style="height:150px;"></div>
         <footer class="footer_curr" id="footer_curr">{% include "footer.html" %}</footer></div>
</main>
<form id="fileForm"></form>

{% include "search_div.html" %}
{% include "feedback.html" %}
</body>
{% include "commonJS.html" %}
   <script type="text/javascript">
         var tabs=document.getElementById("persona-right").getElementsByTagName("li");
    var divs=document.getElementById("persona-left").getElementsByTagName("ul");
    for(var i=0;i<tabs.length;i++){
        tabs[i].onclick=function(){change(this);}
    }
    function change(obj){
        for(var i=0;i<tabs.length;i++)
        {
            if(tabs[i]==obj){
                tabs[i].className="fli";
                divs[i].className="fdiv";
            }
            else{
                tabs[i].className="stote";
                divs[i].className="";
            }
        }
    }
     </script>
<script>
    window.document.onscroll = function(){
        if($(document).scrollTop() == 0){
            $("#head_cont").css("box-shadow","none");
        }else{
            $("#head_cont").css("box-shadow","0 2px 1px rgba(0,0,0,0.5)");
        }
    }
</script>
<script>
    $(document).ready(function(){
		$(".ui-select").selectWidget({
			change       : function (changes) {
				return changes;
			},
			effect       : "slide",
			keyControl   : true,
			speed        : 200
		});
	});

function resetHP(){
        $.post("/u/editpage/default_headimg",function(data){
            $("#uheadimg_this").attr("src",data.headimg);
            $("#uheadimg").attr("src",data.headimg);
            showPrompt("已经恢复预设头像~");
        },"json")
    }

    function showPrompt(message){
        $("#promptDIV").html(message);
        $("#promptDIV").css("top","0px");
        setTimeout(function(){
            $("#promptDIV").css("top","-75px");
        },2000)
    }
    $("#headimg").on("change", imageCompress);

    function submitINFO(info_name){
        $.post("/u/editpage/editelse",$("#fileForm").serialize(),function(data){
            showPrompt(info_name+" 修改成功~");
        })
    }
    function submitINFO_name(t){
        if(t.value.trim() == ""){
            input_error(t,"昵称不能为空~");
            t.focus();
        }else{
            $.post("/u/editpage/nickname",{"uid":$("#uid").val(),"nickname":t.value},function(data){

                if(data.code == 0){
                    input_blur(t);
                    showPrompt("昵称修改成功~");
                }else{
                    input_error(t,"昵称已存在! 换一个呗~");
                    t.focus();
                }
            },"json")
        }
    }
    function submitINFO_pad(t){
        if(t.value.trim() == ""){
            input_error(t,"密码不能为空~");
            t.focus();
        }else{
            $.post("/u/editpage/resetpw",{"password":t.value},function(data){
                if(data.code==0){
                    input_blur(t);
                    showPrompt("密码修改成功");
                    $(t).slideUp(50);
                    $(t).parent().parent().find("button").slideDown(200);
                }else{
                    input_error(t,"服务器异常，请稍后再试~");
                    t.focus();
                }
            },"json")
        }
    }
    function submitINFO_phone(t){
        if(t.value.trim() == ""){
            input_error(t,"手机号不能为空~");
            t.focus();
        }else{
            if(!checkPhone(t.value.trim())){
                input_error(t,"手机号格式有误！");
                t.focus();
            }else{
                $.post("/u/exists","phone="+t.value,function(data){
                    if(data.code == "0"){
                        input_blur(t);
                        $("#phone_span").show();
                        $("#phone_span").focus();
                        phoneNumber = t.value;
                        $.post("/u/phonecode",{phone:t.value},function(data){
                            if(data.code == 0){
                                pcode = data.phone_code;
                                showPrompt("验证码已发送至 "+t.value+", 请查看短信、并输入验证码！");
                            }else{
                                swal("验证码错误", "短信发送失败~！请您稍后再试！", "error");
                            }
                        },"json")
                    }else{
                        input_error(t,"手机号已被使用！");
                        t.focus();
                    }
                },'json')
            }
        }
    }

    function submitINFO_phone_add(t){
        if(pcode == MD5(t.value)){
            if(phoneNumber == $("#phone").val()){
                $.post("/u/editpage/resetphone",{phone:$("#phone").val()},function(data){
                    if(data.code == "0"){
                        showPrompt("手机号修改成功！ 登陆账号为："+$("#phone").val());
                        input_blur(t);
                        $("#phone_span").slideUp();
                        t.value = "";
                    }else{
                        swal("修改错误", "手机号修改失败~！请您稍后再试！", "error");
                    }
                },"json")
            }else{
                input_error($("#phone"),"手机号与之前不匹配！");
                $("#phone").focus();
            }
        }else{
            input_error(t,"验证码错误！");
            t.focus();
        }
    }
    function input_error(t,message){
        $(t).css("border","2px solid rgb(214,96,97)");
        $(t).parent().find("span").html(message);
        $(t).parent().find("span").slideDown();
    }
    function input_blur(t){
        $(t).css("border","2px solid #ECEFF1");
        $(t).parent().find("span").slideUp();
    }
    function showPassword(t){
        $(t).slideUp(100);
        $(t).parent().find(".password").slideDown(100);
        $(t).parent().find(".password").focus();
    }
    function bindGitHub(t){
        if($(t).attr("class") == "off"){
            $(t).attr("class","on_github");
            $(t).find("img").attr("src","/static/svg/fangmao.svg");
            location.href = "/u/editpage/github?status=on";
            showPrompt("正在绑定GitHub账号~请您稍后~");
        }else{
            $(t).attr("class","off");
            $(t).find("img").attr("src","/static/svg/fangmao_hui.svg");
            $.get("/u/editpage/github?status=off",function(data){
                if(data.code == 0){
                    showPrompt("成功解绑GitHub账号~");
                }
            },"json");
        }
    }
    function showbindP(t){
        if($(t).attr("class") == "off"){
            $(t).attr("class","on_p");
            $(t).find("img").attr("src","/static/svg/www.svg");
            setTimeout(function(){
                $(t).animate({width: 'toggle', opacity: 'hide'}, 'normal',function(){ $(t).hide();});
                $(t).parent().find("input").animate({width: 'toggle', opacity: 'show'}, 'normal',function(){ $(t).parent().find("input").show();});
                $(t).parent().find("input").focus();
            },350);
        }else{
            $(t).attr("class","off");
            $(t).find("img").attr("src","/static/svg/www_hui.svg");
            $.post("/u/editpage/personpage",{"personpage":""},function(data){
                showPrompt("成功解绑个人主页~");
            })
        }
    }
    function bindP(t){
        var www = t.value;
        if(www.indexOf("http") == -1){
            www = "http://"+www;
        }
        $.post("/u/editpage/personpage",{"personpage":www},function(data){
            showPrompt("绑定个人主页成功~");
            $(t).animate({width: 'toggle', opacity: 'show'}, 'normal',function(){ $(t).show();});
            $(t).parent().find("div").animate({width: 'toggle', opacity: 'hide'}, 'normal',function(){ $(t).parent().find("input").hide();});
        })
    }
</script>
</html>